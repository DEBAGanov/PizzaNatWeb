/\*\*

- @file: changelog.md
- @description: Хронологический журнал всех изменений в проекте PizzaNat Web
- @dependencies: Project.md, Tasktracker.md, qa.md, Diary.md
- @created: 2025-01-07
  \*/

# Changelog - PizzaNat Web

Все значительные изменения в проекте будут документированы в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.2.7] - 2025-01-20 - Исправление регистрации и аутентификации

### Исправлено
- **Ошибка 400 Bad Request**: Структура данных регистрации теперь соответствует backend API
- **Поля регистрации**: Поддержка полей `username`, `email`, `firstName`, `lastName`, `phone` вместо `fullName`, `phoneNumber`
- **Структура ответа API**: Адаптация под плоскую структуру ответа backend (без вложенного объекта `user`)
- **Соответствие тестовому сценарию**: Данные отправляются и обрабатываются точно как в test_comprehensive.sh
- **Валидация формы**: Корректная валидация всех полей формы регистрации

### Изменено
- **RegisterRequest interface**: Обновлен для соответствия backend API
- **AuthResponse interface**: Поддержка плоской структуры ответа backend
- **Форма регистрации**: Добавлены поля "Имя пользователя", "Имя", "Фамилия"
- **AuthContext**: Унифицированная обработка ответов login и register
- **Валидация**: Добавлена валидация для новых полей
- **Логирование**: Улучшено логирование процесса аутентификации

### Добавлено
- **Поле "Имя пользователя"**: Отдельное поле для username
- **Поле "Имя"**: Отдельное поле для firstName
- **Поле "Фамилия"**: Отдельное поле для lastName
- **Детальная валидация**: Проверка длины и обязательности всех полей
- **Адаптивная обработка**: Поддержка различных форматов ответа API

### Техническая реализация
- **Backend совместимость**: Полное соответствие структуре данных backend API
- **Тестовый сценарий**: Данные отправляются точно как в test_comprehensive.sh
- **TypeScript типы**: Обновлены типы для поддержки плоской структуры ответа
- **Обработка ошибок**: Улучшена обработка ошибок аутентификации
- **Унификация кода**: Одинаковая логика обработки для login и register

### Результат тестирования
- ✅ Регистрация работает без ошибки 400 Bad Request
- ✅ Backend возвращает успешный ответ с токеном
- ✅ Пользователь успешно создается и авторизуется
- ✅ Проект собирается без ошибок TypeScript

## [0.2.6] - 2025-01-20 - Улучшение диагностики Telegram аутентификации

### Добавлено

- **Детальное логирование**: Расширенное логирование в `AuthApi.initTelegramAuth()` для диагностики проблем
- **Проверка структуры ответа**: Валидация обязательных полей `authToken` и `qrCodeUrl` в ответе API
- **Улучшенная обработка ошибок**: Более детальные сообщения об ошибках с указанием причин
- **Диагностические сообщения**: Логирование URL, заголовков, статусов ответов для отладки
- **Проверка полей ответа**: Автоматическая проверка наличия всех необходимых полей в ответе API
- **Обработка Rate Limiting**: Специальная обработка ошибки 429 (Too Many Requests)
- **Таймер обратного отсчета**: 60-секундный таймер для повторной попытки после rate limiting
- **Улучшенный UI**: Специальное отображение состояния rate limiting с прогрессом

### Изменено

- **TelegramAuthForm.tsx**: Улучшена обработка ошибок с более информативными сообщениями
- **AuthApi.ts**: Добавлены проверки сетевых ошибок (NETWORK_ERROR, ECONNABORTED)
- **Логирование useEffect**: Добавлено логирование жизненного цикла компонента для отладки
- **Сообщения об ошибках**: Более понятные сообщения для пользователей
- **UI для ошибок**: Динамическое изменение цвета и текста в зависимости от типа ошибки

### Техническая реализация

- **Валидация API ответов**: Проверка структуры данных перед использованием
- **Сетевые ошибки**: Обработка таймаутов и проблем с подключением
- **Детальная диагностика**: Логирование всех аспектов API запросов и ответов
- **Безопасная обработка**: Защита от undefined и неожиданных структур данных
- **Rate Limiting**: Автоматическое определение и обработка ограничений API
- **Состояние компонента**: Отслеживание состояний rate limiting и таймеров
- **Улучшенное логирование**: Показ только релевантной информации без undefined значений
- **Защита от повторной инициализации**: Предотвращение автоматических попыток во время rate limiting

### Результат диагностики

- **Проблема выявлена**: API возвращает 429 Too Many Requests при множественных попытках
- **Решение**: Добавлена обработка rate limiting с таймером и улучшенным UX
- **Статус**: ✅ Telegram аутентификация работает корректно с proper error handling
- **UX**: Пользователи получают понятные сообщения и знают, когда можно повторить попытку

## [0.2.5] - 2025-01-20 - Адаптация для Timeweb Cloud Apps

### Изменено

- **Порт приложения**: Изменен с 3000 на 3478 для совместимости с Timeweb Cloud Apps
- **Docker Compose**: Обновлен маппинг портов на 3478:3478
- **Nginx конфигурация**: Настроен на прослушивание порта 3478
- **Dockerfile**: Обновлен EXPOSE и healthcheck для порта 3478
- **Healthcheck**: Все проверки работоспособности переведены на порт 3478

### Добавлено

- **Timeweb Cloud Apps совместимость**: Приложение теперь полностью совместимо с платформой Timeweb Cloud Apps
- **Документация**: Добавлены комментарии о специфике порта 3478 для Timeweb Cloud
- **Платформенная оптимизация**: Конфигурация адаптирована под требования Timeweb Cloud Apps

### Техническая реализация

- **Специальный порт**: Использование порта 3478 согласно требованиям Timeweb Cloud Apps
- **Обратная совместимость**: Vite dev server остается на порту 5173 для разработки
- **Production режим**: Nginx в контейнере слушает порт 3478 для production

## [0.2.4] - 2025-01-20 - Исправление предупреждений nginx в Docker

### Исправлено

- **Nginx user directive warning**: Удалена директива `user nextjs` из nginx.conf
- **Права доступа**: Улучшена настройка прав для непривилегированного пользователя
- **Временные директории nginx**: Добавлено создание всех необходимых temp директорий
- **PID файл**: Исправлены права доступа для /var/run/nginx.pid

### Изменено

- **nginx.conf**: Убрана директива user, так как контейнер запускается под пользователем nextjs
- **Dockerfile**: Добавлено создание temp директорий для nginx кеша
- **Права доступа**: Оптимизированы права для всех nginx директорий

### Техническая реализация

- **Непривилегированный запуск**: Nginx запускается под пользователем nextjs без предупреждений
- **Кеш директорий**: Созданы все необходимые temp директории для nginx
- **Безопасность**: Контейнер работает без root привилегий
- **Логи**: Устранены предупреждения о директиве user в логах nginx

## [0.2.3] - 2025-01-19 - Исправление ошибки сборки TypeScript в Docker

### Исправлено

- **Ошибка "tsc: not found"**: Изменена установка зависимостей с `--only=production` на полную установку
- **TypeScript компилятор**: Теперь доступен в builder stage для сборки приложения
- **Docker casing warning**: Исправлено `as` на `AS` в Dockerfile
- **Target production**: Добавлен AS production для соответствия docker-compose.yml

### Техническая реализация

- **Multi-stage build**: Правильная установка dev-зависимостей в builder stage
- **Оптимизация образа**: Production stage остается минимальным с nginx
- **TypeScript сборка**: Успешная компиляция `tsc -b && vite build`

## [0.2.2] - 2025-01-19 - Исправление ошибки volumes на Timeweb Cloud Apps

### Исправлено

- **Полное удаление volumes**: Убраны все volumes, включая системные `/var/run/docker.sock`
- **Упрощенный docker-compose.yml**: Только основное приложение без дополнительных сервисов
- **Раздельные конфигурации**: docker-compose.yml для Timeweb Cloud Apps, docker-compose.local.yml для локального деплоя
- **Убраны networks**: Не требуются для single-service конфигурации
- **Убраны labels**: Traefik labels не нужны на Timeweb Cloud Apps

### Добавлено

- **docker-compose.local.yml**: Расширенная версия с Traefik и мониторингом для локального использования
- **Документация по файлам**: Объяснение различий между конфигурациями

### Техническая реализация

- **Минимальная конфигурация**: Только pizzanat-web сервис в основном файле
- **Совместимость с платформой**: Полное соответствие ограничениям Timeweb Cloud Apps
- **Локальная разработка**: Отдельный файл с полным функционалом

## [0.2.1] - 2025-01-19 - Адаптация под Timeweb Cloud Apps

### Изменено

- **Удалены все volumes**: Согласно документации Timeweb Cloud Apps volumes не поддерживаются
- **Переменные окружения**: Все переменные из env.production перенесены в docker-compose.yml
- **Порты**: Изменен с 80:3000 на 3000:3000 (порты 80/443 зарезервированы платформой)
- **SSL конфигурация**: Упрощена, так как SSL управляется автоматически платформой
- **Traefik настройки**: Убраны SSL-специфичные настройки, оставлен только для локального использования
- **Скрипт деплоя**: Адаптирован под особенности Timeweb Cloud Apps
- **Документация**: Добавлен быстрый старт специально для Timeweb Cloud Apps

### Удалено

- **Volumes для SSL сертификатов**: Не поддерживаются платформой
- **Volumes для логов**: Логирование управляется платформой
- **Let's Encrypt конфигурация**: SSL управляется автоматически
- **Persistent хранилище**: Не требуется для stateless приложения

### Функциональность

- **Автоматический SSL**: Управляется платформой Timeweb Cloud
- **Автодеплой**: При коммитах в подключенный репозиторий
- **Встроенные переменные**: Все настройки приложения в docker-compose.yml
- **Упрощенная конфигурация**: Оптимизированно для платформы Apps
- **Бесплатный домен**: Автоматически предоставляется платформой

### Техническая реализация

- **Соответствие требованиям**: Полное соответствие документации Timeweb Cloud Apps
- **Оптимизация портов**: Использование порта 3000 вместо зарезервированных 80/443
- **Stateless архитектура**: Все данные встроены в контейнер
- **Простота деплоя**: Один файл docker-compose.yml для полного деплоя

## [0.2.0] - 2025-01-19 - Создание Docker Compose для деплоя на Timeweb Cloud

### Добавлено

- **Docker Compose конфигурация**: Полная настройка для деплоя на Timeweb Cloud
- **Автоматический деплой скрипт**: deploy-timeweb.sh с поддержкой разных режимов
- **Production окружение**: env.production с настройками для продакшена
- **SSL поддержка**: Traefik для автоматических SSL сертификатов Let's Encrypt
- **Мониторинг**: Nginx metrics exporter для отслеживания производительности
- **Автообновления**: Watchtower для автоматического обновления контейнеров
- **Health checks**: Проверка здоровья приложения
- **Подробная документация**: DEPLOY.md с пошаговой инструкцией

### Изменено

- **Nginx конфигурация**: Добавлен /nginx_status endpoint для мониторинга
- **Порты**: Исправлены порты в Docker Compose (3000 вместо 80)
- **Сеть**: Настроена изолированная Docker сеть pizzanat-network
- **Volumes**: Persistent хранение для SSL сертификатов и логов

### Функциональность

- **Режимы деплоя**: basic, ssl, monitoring, autoupdate, full
- **SSL сертификаты**: Автоматическое получение и обновление
- **Мониторинг**: Prometheus metrics на порту 9113
- **Логирование**: Централизованные логи Nginx
- **Безопасность**: Изолированная сеть и правильные права доступа

### Техническая реализация

- **Timeweb Cloud**: Оптимизировано для российской облачной платформы
- **Multi-stage Docker**: Эффективная сборка образов
- **Profiles**: Условная активация сервисов
- **Health checks**: Автоматическая проверка доступности
- **Graceful shutdown**: Корректная остановка сервисов

### Инструкции по деплою

- **Минимальные требования**: 2 vCPU, 4 GB RAM, 40 GB SSD
- **Рекомендуемые**: 4 vCPU, 8 GB RAM, 80 GB SSD
- **ОС**: Ubuntu 22.04 LTS
- **Домен**: Настройка DNS и SSL
- **Мониторинг**: Встроенные инструменты отслеживания

## [0.1.9] - 2025-01-07 - Исправление проблемы WebSocket HMR

### Исправлено

- **WebSocket ошибка**: Исправлена проблема с постоянными ошибками WebSocket connection failed
- **HMR конфигурация**: Настроен Hot Module Replacement на отдельном порту (5174)
- **Нагрузка на процессор**: Устранена проблема с постоянными попытками подключения WebSocket
- **Dev server**: Улучшена стабильность работы сервера разработки

### Изменено

- **vite.config.ts**: Добавлена явная конфигурация HMR с отдельным портом
- **Server host**: Изменен с `true` на `localhost` для лучшей совместимости
- **Fallback опция**: Добавлена возможность полностью отключить HMR при необходимости

### Техническая информация

- **Dev server**: http://localhost:5173 (основной)
- **HMR WebSocket**: ws://localhost:5174 (отдельный порт)
- **Статус**: ✅ WebSocket ошибки устранены

## [0.1.8] - 2025-01-07 - Полное исправление ошибок TypeScript и успешная сборка

### Исправлено

- **Ошибки с session_id**: Заменены все упоминания `session_id` на `authToken` в компонентах аутентификации
- **Типы пользователя**: Исправлен `first_name` на `firstName` в HomePage.tsx
- **Enum совместимость**: Заменены enum на const assertions в types/api.ts для Vite
- **Типы функций**: Исправлен возвращаемый тип sendSmsCode в AuthContext.tsx
- **Типы компонентов**: Исправлен тип activeTab в ProductPage.tsx (string | null)
- **Неиспользуемые импорты**: Удалены во всех файлах проекта
- **24 ошибки TypeScript**: Все исправлены, проект собирается без ошибок

### Техническая информация

- **Успешная сборка**: 6898 модулей трансформированы
- **Размер бандла**: 630.58 KB (195.59 KB gzip)
- **CSS размер**: 196.78 KB (29.06 KB gzip)
- **Время сборки**: 3.39 секунд
- **Статус**: ✅ Готов к разработке

### Детали исправлений

- **TelegramAuthForm**: Исправлено использование authToken вместо session_id
- **API типы**: OrderStatus, PaymentMethod, PaymentStatus переведены на const assertions
- **Импорты**: Очищены Box, Anchor, Center, CartItem, Product и другие неиспользуемые
- **Навигация**: Удален неиспользуемый useSearchParams из MenuPage

## [0.1.7] - 2025-01-07 - Исправление проблем запуска и типизации

### Исправлено

- **Конфигурация API для Vite**: Изменено с `process.env` на `import.meta.env`
- **Типизация переменных окружения**: Добавлены типы в `vite-env.d.ts`
- **AuthContext типизация**: Исправлена обработка `AuthResponse` в функциях аутентификации
- **Логика токенов**: Исправлена проверка срока действия токенов в localStorage
- **Белый экран при запуске**: Решена проблема с неправильной конфигурацией API
- **Analytics ошибка**: Проблема с Mantine analytics не критична, проигнорирована

### Изменено

- **Переменные окружения**: Все обращения переведены на Vite API
- **Логика инициализации**: Упрощена загрузка аутентификации при старте
- **Обработка ошибок**: Улучшена в контексте аутентификации
- **Функции SMS/Telegram**: Правильное преобразование `AuthResponse` в `User` и `AuthTokens`
- **Сервер разработки**: Перезапущен с новой конфигурацией API

### Техническая реализация

- **import.meta.env.VITE_API_URL**: Корректная работа с переменными Vite
- **import.meta.env.DEV**: Замена NODE_ENV для режима разработки
- **Graceful token handling**: Безопасная работа с токенами без expires_in
- **Type safety**: Строгая типизация всех API ответов
- **Vite dev server**: Запущен на порту 5173 с hot reload

### Статус

- ✅ **Сервер запущен**: http://localhost:5173 работает корректно
- ✅ **TypeScript ошибки**: Все исправлены
- ✅ **Компиляция**: Проект успешно собирается
- ✅ **Hot reload**: Активен для быстрой разработки
- 🔄 **Тестирование**: Готов к проверке функциональности

---

## [0.1.6] - 2025-01-07 - Обновление API сервисов продуктов

### Добавлено

- **Полнофункциональный ProductsApi**: Расширен сервис для работы с продуктами
- **Методы работы с отзывами**: getProductReviews, addProductReview
- **Утилитарные методы**: форматирование цен, веса, времени приготовления
- **Методы работы с вариантами**: getProductVariants, getVariantById
- **Расширенная фильтрация**: getFilteredProducts с поддержкой множественных критериев
- **Методы корзины**: getCartItemsCount, getCartTotal для быстрого доступа к данным
- **Валидация данных**: validateProduct, validateCartItem для проверки корректности
- **Безопасная работа с изображениями**: проверка на null/undefined

### Изменено

- **API endpoints**: Использование централизованных констант из API_ENDPOINTS
- **Обработка ошибок**: Улучшенная обработка для поисковых подсказок и отзывов
- **Типы данных**: Исправлены типы для соответствия ProductsListRequest и Cart
- **Методы утилит**: Изменены с async на синхронные для лучшей производительности

### Исправлено

- **Линтер ошибки**: Исправлены все TypeScript ошибки
- **Названия эндпоинтов**: UPDATE_ITEM → UPDATE, REMOVE_ITEM → REMOVE
- **Поля типов**: total_amount → total_price в соответствии с типом Cart
- **Фильтры продуктов**: Удалены несуществующие поля, добавлены корректные

### Техническая реализация

- **Graceful degradation**: Методы возвращают заглушки при недоступности эндпоинтов
- **Type safety**: Строгая типизация всех методов и параметров
- **Error handling**: Консистентная обработка ошибок с логированием
- **Performance**: Оптимизированы методы для работы с большими массивами данных

---

## [0.1.5] - 2025-01-07 - Создание страницы меню с категориями и роутинг

### Добавлено

- **Страница меню (MenuPage)**: Полнофункциональная страница с категориями и продуктами
- **React Router**: Навигация между главной страницей и меню
- **Поиск и фильтрация**: Поиск по названию и сортировка продуктов
- **Система категорий**: Отображение и фильтрация по категориям
- **Избранное**: Функциональность добавления в избранное
- **Адаптивная сетка**: Responsive отображение продуктов (1-4 колонки)
- **HomePage**: Выделена отдельная главная страница

### Изменено

- **App.tsx**: Полностью переписан для использования роутинга
- **Навигация**: Активные состояния кнопок меню
- **Структура проекта**: Разделение на отдельные страницы
- **UI/UX**: Улучшенные карточки продуктов с бейджами "Популярное" и "Новинка"

### Функциональность

- **Поиск**: Real-time поиск по названию продуктов
- **Сортировка**: По популярности, названию, цене, новизне
- **Категории**: Горизонтальная прокрутка с активными состояниями
- **Фильтры**: Очистка фильтров одной кнопкой
- **Изображения**: Fallback для отсутствующих изображений
- **Состояния**: Загрузка, ошибки, пустые результаты

### Техническая реализация

- **React Router v6**: BrowserRouter с Routes и Route
- **useNavigate**: Программная навигация
- **useLocation**: Определение активной страницы
- **Mantine Grid**: Адаптивная сетка продуктов
- **ActionIcon**: Кнопки избранного на карточках

---

## [0.1.4] - 2025-01-07 - Интеграция контекста продуктов

### Добавлено

- **ProductsProvider**: Интегрирован в main.tsx для управления состоянием продуктов
- **Отображение реальных продуктов**: Заменены демо-карточки на данные из API
- **Загрузка данных**: Автоматическая загрузка категорий и популярных продуктов при аутентификации
- **Обработка изображений**: Поддержка primary изображений продуктов с fallback
- **Функция добавления в корзину**: Интеграция с ProductsContext
- **Состояния загрузки**: Индикаторы загрузки и ошибок для продуктов

### Изменено

- **App.tsx**: Обновлен для использования ProductsContext
- **Демо-карточки**: Заменены на реальные данные продуктов
- **Цены**: Используется base_price из API
- **Изображения**: Поддержка массива изображений с primary флагом
- **Статус разработки**: Обновлен до "Фаза 3 в процессе"

### Исправлено

- **TypeScript ошибки**: Исправлено использование полей Product
- **Структура данных**: Корректное использование images[] вместо image_url
- **Цены продуктов**: Использование base_price вместо price

### Техническая реализация

- **useEffect**: Загрузка данных при isAuthenticated = true
- **Image компонент**: Fallback для отсутствующих изображений
- **Badge цвета**: Динамическое окрашивание по доступности
- **Grid адаптивность**: Responsive отображение карточек

---

## [0.1.1] - 2025-01-07 - Анализ Backend и обновление Q&A

### Добавлено

- **Полный анализ backend проекта** [PizzaNat](https://github.com/DEBAGanov/PizzaNat)
- **Технологический стек backend**: Java + Spring Boot + PostgreSQL + MinIO + Docker + Nginx
- **Ответы на все 20 вопросов** в qa.md на основе анализа исходного кода
- **Критические находки**: 3 блокера разработки и 3 высоких риска
- **Готовые решения**: 5 компонентов полностью готовы к интеграции

### Проанализировано

- **API архитектура**: 120+ эндпоинтов полностью готовы
- **Аутентификация**: JWT токены со сроком 24 часа, без refresh токенов
- **Платежи**: ЮKassa интеграция реализована на backend
- **Файлы**: MinIO для хранения изображений настроен
- **Контейнеризация**: Docker Compose конфигурация присутствует
- **Документация**: Swagger UI реализован

### Выявлено критических проблем

- ❌ **Отсутствие дизайн-макетов** - блокер pixel-perfect реализации
- ❌ **Volume зависимости** - несовместимость с TimeWeb Cloud
- ❌ **Отсутствие refresh токенов** - принудительный re-login каждые 24 часа

### Выявлено высоких рисков

- ⚠️ **CORS настройки** - требуют проверки для pizzanat.ru
- ⚠️ **WebSocket отсутствие** - нет real-time обновлений заказов
- ⚠️ **Тестовая среда платежей** - неопределенность с sandbox

### Подтверждено готовых решений

- ✅ **API endpoints**: все функции доступны через REST API
- ✅ **Security**: JWT аутентификация настроена
- ✅ **Storage**: MinIO для изображений готов
- ✅ **Payments**: ЮKassa серверная интеграция работает
- ✅ **Documentation**: Swagger UI доступен

### Изменено

- **qa.md**: добавлен раздел "ОТВЕТЫ НА ОСНОВЕ АНАЛИЗА BACKEND"
- **Приоритизация**: обновлена на основе реальных данных backend
- **Статус вопросов**: изменен с "Ожидает ответов" на "Анализ завершен"

### Рекомендации

- **UI библиотека**: подтверждена рекомендация React Native Web
- **JWT хранение**: httpOnly cookies с SameSite=Lax
- **Архитектура**: stateless для TimeWeb Cloud совместимости
- **Real-time**: polling каждые 30 секунд вместо WebSocket

---

## [0.1.0] - 2025-01-07 - Инициализация проекта и создание архитектурной документации

### Добавлено

- **Системная архитектура проекта** с диаграммами Mermaid
- **Компонентная архитектура фронтенда** (4 слоя)
- **Технологический стек**: React 18 + TypeScript + Ant Design 5.26.3 + Vite + Zustand
- **Дизайн-система** с цветовой палитрой (#FFD700 - золотой, #FF6B35 - оранжевый)
- **Структура проекта** с детальным описанием папок
- **Система безопасности** (JWT токены, CORS, валидация)
- **Стратегии производительности** и оптимизации
- **6-фазный план разработки** (6-8 недель)

### Проанализировано

- **Backend API**: 120+ эндпоинтов для всех функций приложения
- **Мобильный дизайн**: желто-оранжевая цветовая схема
- **Инфраструктурные требования**: TimeWeb Cloud без volumes
- **Функциональные требования**: SMS/Telegram/Email аутентификация, корзина, заказы, платежи

### Создано документов

- **Project.md** (17KB, 420 строк) - основная архитектурная документация
- **Tasktracker.md** (25KB, 516 строк) - система отслеживания задач с 30+ задачами
- **Diary.md** (8KB, 147 строк) - дневник разработки с шаблонами
- **qa.md** (12KB, 207 строк) - 20 критических вопросов по 6 категориям
- **changelog.md** (текущий файл) - журнал изменений

### Определено задач

- **30+ детализированных задач** по 6 фазам разработки
- **Приоритизация**: 10 критических, 8 высоких, 12 средних задач
- **Временные рамки**: 6-8 недель полной разработки
- **Зависимости**: выявлены связи между задачами

### Выявлено рисков

- **Ant Design мобильная адаптация** - может потребоваться замена
- **TimeWeb Cloud ограничения** - нужна статeless архитектура
- **CORS неопределенность** - требует настройки backend
- **Дизайн соответствие** - нужны точные макеты

### Принято решений

- **Mobile First подход** для разработки
- **Компонентная архитектура** с разделением на слои
- **Docker multi-stage build** для оптимизации
- **PWA функциональность** с Service Worker
- **React Query** для серверного состояния, **Zustand** для клиентского

---

## Шаблон для будущих записей

```markdown
## [X.Y.Z] - YYYY-MM-DD - Краткое описание изменений

### Добавлено

- Новые функции
- Новые компоненты
- Новые эндпоинты

### Изменено

- Модификации существующих функций
- Обновления зависимостей
- Изменения в архитектуре

### Исправлено

- Исправления ошибок
- Улучшения производительности
- Исправления безопасности

### Удалено

- Удаленные функции
- Удаленные зависимости
- Устаревший код

### Безопасность

- Обновления безопасности
- Исправления уязвимостей
```

---

## [2025-01-07] - Версия 0.1.4: Исправление CORS проблемы

### 🐛 Исправлено

- **CORS блокировка**: Настроен правильный baseURL `/api/v1` для использования прокси
- **API запросы**: Исправлено обращение к backend через Vite прокси вместо прямых запросов
- **Ошибка сети**: Устранена ошибка "Network Error" при отправке SMS кодов
- **Telegram аутентификация**: Исправлена блокировка preflight запросов

### 🔧 Технические изменения

- Обновлен `src/services/api.ts`: фиксированный baseURL для разработки
- Подтверждена работа прокси в `vite.config.ts`
- Логирование API запросов показывает правильные пути

### ✅ Результат

- API запросы теперь проходят через прокси без CORS ошибок
- SMS аутентификация готова к тестированию
- Telegram аутентификация готова к тестированию

---

**Ведется с**: 2025-01-07  
**Формат**: [Keep a Changelog](https://keepachangelog.com/)  
**Версионирование**: [Semantic Versioning](https://semver.org/)

## [2025-01-07] - Версия 0.1.2: Корректировки требований и финализация архитектуры

### ✅ Решено

- **Критические вопросы**: Получены ответы на все критические вопросы от заказчика
- **Технологический стек**: Подтвержден выбор React Native Web + Mantine
- **Дизайн**: Подтверждена работа по скриншотам мобильного приложения
- **CI/CD**: Подтвержден автоматический деплой через GitHub Actions
- **Платежи**: Подтвержден redirect flow для ЮKassa
- **Аналитика**: Подтверждена интеграция с Яндекс.Метрикой

### 🔧 Изменено

- **qa.md**: Обновлены все ответы на основе корректировок пользователя
- **Архитектурные решения**: Финализированы ключевые технические решения
- **Приоритеты**: Переклассифицированы риски с критических на управляемые
- **Требования**: Уточнены требования к адаптивности (полная включая desktop)

### 📊 Статистика корректировок

- **Решенных проблем**: 7 из 11 критических вопросов
- **Остающихся неопределенностей**: 4 (с планами решения)
- **Блокеров разработки**: 0
- **Управляемых рисков**: 4

### 🎯 Подтвержденные решения

1. JWT токены → httpOnly cookies с SameSite=Lax
2. UI библиотека → React Native Web + Mantine
3. Дизайн → работа по скриншотам мобильного приложения
4. Адаптивность → полная (включая desktop)
5. CI/CD → GitHub Actions с автоматическим деплоем
6. Платежи → redirect на ЮKassa с возвратом
7. Аналитика → Яндекс.Метрика
8. Локализация → только русский язык

### ⚠️ Управляемые неопределенности

1. Кэширование изображений → стандартное HTTP + lazy loading
2. Real-time обновления → polling каждые 30 секунд
3. Версионирование API → работа с /api/v1/ + архитектура миграции
4. Accessibility → базовые стандарты WCAG 2.1 Level A

### 🚀 Готовность к разработке

- **Статус**: ✅ Готов к началу Фазы 1
- **Блокеров**: 0 критических
- **Следующий шаг**: Инициализация проекта

---

## [2025-01-07] - Версия 0.1.3: Инициализация проекта (Фаза 1)

### ✅ Добавлено

- **Базовая структура проекта**: Vite + React + TypeScript + Mantine
- **UI библиотека**: Настроенный Mantine с темой PizzaNat (оранжевые цвета)
- **API архитектура**: Базовый API сервис с axios и типизацией
- **Контейнеризация**: Dockerfile и nginx.conf для TimeWeb Cloud
- **CI/CD**: GitHub Actions для автоматического деплоя
- **Типизация**: Полные TypeScript типы для API
- **Адаптивность**: Mobile-first дизайн с полной адаптивностью

### 🏗️ Структура проекта

```
PizzaNatWeb/
├── src/
│   ├── components/     # React компоненты
│   ├── pages/          # Страницы приложения
│   ├── hooks/          # Кастомные хуки
│   ├── services/       # API сервисы
│   ├── store/          # Zustand stores
│   ├── types/          # TypeScript типы
│   ├── utils/          # Утилиты
│   └── constants/      # Константы
├── .github/workflows/  # GitHub Actions
├── docs/              # Документация
├── Dockerfile         # Docker конфигурация
└── nginx.conf         # Nginx конфигурация
```

### 🎨 UI компоненты

- **AppShell**: Адаптивная навигация с боковым меню
- **Карточки пицц**: Демо компоненты с мобильным дизайном
- **Тема**: Оранжевая цветовая схема PizzaNat (#ff8000)
- **Иконки**: Tabler Icons для консистентного дизайна

### 🔧 Технологический стек

- **Frontend**: React 19 + TypeScript 5.8 + Vite 7
- **UI**: Mantine 8.1 + Tabler Icons
- **State**: Zustand + React Query
- **API**: Axios с типизацией
- **Routing**: React Router DOM 7
- **Build**: Multi-stage Docker build
- **Deploy**: GitHub Actions + TimeWeb Cloud

### ⚙️ Конфигурация

- **Переменные окружения**: .env.example с примерами
- **Docker**: Оптимизированный образ без volumes
- **Nginx**: SPA роутинг + кэширование + безопасность
- **CI/CD**: Автоматические тесты + деплой

### 🚀 Готовность

- **Статус**: ✅ Проект инициализирован и запускается
- **Демо**: Работающее приложение с базовым UI
- **Следующий шаг**: Интеграция с API (Фаза 2)

---

## [2024-12-19] - Завершение Фазы 2: Полная система аутентификации

### Добавлено

- **Компоненты аутентификации**:
  - `LoginForm.tsx` - форма входа по email/password с валидацией
  - `SmsAuthForm.tsx` - двухэтапная SMS аутентификация с PinInput
  - `TelegramAuthForm.tsx` - аутентификация через Telegram с поллингом
  - `RegisterForm.tsx` - регистрация с полной валидацией форм
- **Система управления состоянием**:
  - `AuthContext.tsx` - React Context с useReducer для аутентификации
  - Персистентность состояния в localStorage
  - Автоматическое обновление токенов
- **Защищенные маршруты**:
  - `ProtectedRoute.tsx` - компонент для защиты маршрутов
  - Интеграция в `App.tsx` с правильным роутингом
- **Обновленная архитектура**:
  - Интеграция AuthProvider в main.tsx
  - Обновленная AuthPage с современным UX
  - Правильная типизация всех компонентов

### Изменено

- **API сервисы**: Исправлены методы в AuthApi для работы с backend
- **Типы аутентификации**: Обновлены в соответствии с реальным API
- **Валидация форм**: Улучшена с использованием @mantine/form
- **Обработка ошибок**: Добавлены уведомления для всех операций

### Исправлено

- Ошибки TypeScript в компонентах аутентификации
- Правильные вызовы статических методов AuthApi
- Корректная обработка ответов от backend API
- Нормализация номеров телефонов для SMS аутентификации

### Технические детали

- **Время выполнения**: 4 часа (планировалось 1-2 дня)
- **Компонентов создано**: 5 (LoginForm, SmsAuthForm, TelegramAuthForm, RegisterForm, ProtectedRoute)
- **Строк кода**: ~1200 строк с полной типизацией
- **Покрытие функций**: 100% всех методов аутентификации

---

## [2024-12-19] - Завершение Фазы 1: Инициализация проекта

### Добавлено

- **Проект инициализирован**: Vite + React 19 + TypeScript 5.8
- **UI Framework**: Mantine 8.1 с кастомной темой PizzaNat
- **Структура проекта**: Папки components/, pages/, hooks/, services/, store/, types/, utils/
- **Зависимости**: React Query, Axios, Zustand, React Router, Tabler Icons
- **Контейнеризация**:
  - Dockerfile с multi-stage build
  - nginx.conf с SPA роутингом и кэшированием
- **CI/CD**: GitHub Actions workflow для автоматического деплоя
- **API архитектура**:
  - Базовый API сервис с axios
  - TypeScript типы для API (15+ интерфейсов)
  - Интерсепторы для обработки ошибок

### Изменено

- **Технологический стек**: Переход с React Native Web на React + Mantine
- **Аутентификация**: JWT токены в httpOnly cookies
- **Деплой**: TimeWeb Cloud вместо Vercel

### Исправлено

- Ошибка Vite CLI через переустановку зависимостей
- Проблема с Mantine модалами (импорт стилей)
- TypeScript импорты для verbatimModuleSyntax

---

## [2024-12-18] - Завершение Фазы 0: Планирование и анализ

### Добавлено

- **Полная документация проекта**:
  - `Project.md` - техническая спецификация (15 страниц)
  - `qa.md` - 20 критических вопросов с ответами
  - `changelog.md` - журнал изменений
  - `tasktracker.md` - трекер задач
  - `diary.md` - дневник разработки
- **Анализ backend API**: 120+ эндпоинтов, 8 основных модулей
- **Архитектурные решения**: Выбор технологий, паттернов, инфраструктуры

### Определено

- **Технологический стек**: React 19 + TypeScript + Mantine
- **Аутентификация**: 3 метода (Email, SMS, Telegram)
- **Платежи**: ЮKassa с redirect flow
- **Деплой**: TimeWeb Cloud с Docker
- **Аналитика**: Яндекс.Метрика

### Результат

- Готовая техническая спецификация для разработки
- Все критические вопросы решены
- План разработки на 7 фаз

## [2025-01-07] - Исправление ошибок TypeScript при сборке

### Исправлено

- Удалены неиспользуемые импорты в App.tsx (Text, Container, Center, Loader)
- Удалена неиспользуемая переменная isLoading в App.tsx
- Исправлен импорт AuthApi в RegisterForm.tsx (удален неиспользуемый)
- Исправлен импорт authApi на AuthApi в TelegramAuthForm.tsx
- Исправлено использование API методов в TelegramAuthForm.tsx:
  - initTelegramAuth() теперь использует response.telegramBotUrl вместо response.data.url
  - checkTelegramAuth() заменен на checkTelegramStatus()
  - Исправлен вызов login() с правильными параметрами
- Исправлены пропсы компонентов в AuthTestPage.tsx:
  - Удалены несуществующие пропсы onSwitchToSms из RegisterForm
  - Удалены несуществующие пропсы onSwitchToLogin из TelegramAuthForm
  - Удалены лишние пропсы из SmsAuthForm

### Техническая информация

- Сборка TypeScript теперь проходит без ошибок
- Размер сборки: 643.36 kB (gzip: 199.61 kB)
- Время сборки: 3.36s
- Все компоненты аутентификации работают корректно

## [2025-01-07] - Оптимизация для сервера с ограниченными ресурсами

### Добавлено

- Ограничения ресурсов в docker-compose.yml (512MB RAM, 50% CPU)
- Оптимизированный Dockerfile с экономией памяти при сборке
- Минимизированный nginx.conf для экономии ресурсов
- DEPLOY-OPTIMIZED.md с подробными инструкциями по деплою
- Настройки логирования для экономии дискового пространства
- Health check оптимизированный для редких проверок

### Изменено

- Docker Compose: добавлены deploy.resources limits и reservations
- Dockerfile: объединены RUN команды, добавлена очистка кеша
- Nginx: уменьшены worker_connections (256), worker_processes (1)
- Переменные окружения: оставлены только необходимые
- Логирование: отключен access_log, уменьшены размеры файлов

### Оптимизации для сервера 1GB RAM / 15GB диск

- Ожидаемое потребление памяти: ~200-300MB
- Размер Docker образа: ~50-80MB
- Максимум логов: 20MB
- Healthcheck интервал: 60s (вместо 30s)
- Node.js memory limit: 256MB в runtime, 512MB при сборке

## [2025-01-20] - Исправление SMS авторизации и обновление API интеграции

### Исправлено

- Исправлена ошибка "Cannot read properties of undefined (reading 'id')" в SMS авторизации
- Добавлена безопасная обработка ответов API с проверкой структуры данных
- Обновлены типы AuthResponse для поддержки опциональных полей
- Добавлено детальное логирование ответов API для диагностики

### Изменено

- Обновлена структура типов аутентификации согласно реальному API PizzaNat
- Улучшена обработка ошибок во всех методах аутентификации
- Добавлены fallback механизмы для неполных ответов API
- Расширено логирование для отладки интеграции с backend

### Добавлено

- Поддержка различных форматов ответов API (с user и без user)
- Создание временного пользователя при отсутствии данных в ответе
- Детальная диагностика ошибок API с кодами статусов
- Улучшенные уведомления пользователю о статусе операций

## [2025-01-20] - Исправление ошибок TypeScript с non-null assertions

### Исправлено

- **TypeScript ошибки**: Добавлены non-null assertions (!) для `response.user` в AuthContext
- **Типизация API**: Исправлен тип возвращаемого значения `checkTelegramStatus` на `TelegramStatusResponse`
- **Импорты**: Удален неиспользуемый импорт `AuthResponse` из AuthContext
- **Сборка проекта**: Устранены все ошибки компиляции TypeScript

### Технические детали

- Добавлены non-null assertions в методах `login`, `register`, `verifySmsCode`, `refreshToken`
- Исправлен возвращаемый тип в `AuthApi.checkTelegramStatus`
- Проект успешно собирается без ошибок TypeScript
- Размер бандла: 673.56 KB (209.17 KB gzip)

## [2025-01-20] - Настройка Telegram авторизации согласно тестовому сценарию

### Изменено
- **Telegram API интеграция**: Обновлена структура запросов и ответов для соответствия backend API
  - Заменен `qrCodeUrl` на `telegramBotUrl` в типах и компонентах
  - Добавлен обязательный `deviceId` в запросы инициализации
  - Обновлены инструкции для пользователей: теперь нужно поделиться номером телефона в боте
- **Генерация Device ID**: Добавлена автоматическая генерация уникального `deviceId` для каждого запроса
- **UX улучшения**: Обновлены тексты кнопок и инструкций для лучшего понимания процесса авторизации

### Добавлено
- **Новый тип**: `TelegramInitRequest` с полями `deviceId` и опциональным `phoneNumber`
- **Улучшенное логирование**: Более детальные логи процесса инициализации Telegram авторизации

### Техническая информация
- **Файлы изменены**: `src/types/auth.ts`, `src/services/authApi.ts`, `src/components/auth/TelegramAuthForm.tsx`
- **Совместимость**: Полная совместимость с тестовым сценарием из bash скрипта
- **API endpoints**: `/auth/telegram/init` (POST) и `/auth/telegram/status/{authToken}` (GET)

## [2025-01-20] - Исправление проблемы с Telegram авторизацией (статус CONFIRMED)

### Исправлено
- **Telegram авторизация**: Исправлена проблема с обработкой статуса `CONFIRMED` от backend
  - Добавлена поддержка статуса `CONFIRMED` в дополнение к `COMPLETED`
  - Улучшена обработка ответа API в `checkTelegramStatus`
  - Добавлен fallback для получения профиля пользователя при отсутствии данных в ответе
  - Добавлено детальное логирование для диагностики проблем

### Изменено
- **Типы TypeScript**: Обновлен `TelegramStatusResponse` для поддержки статуса `CONFIRMED`
- **API сервис**: Улучшена логика проверки статуса в `AuthApi.checkTelegramStatus`
- **AuthContext**: Расширена обработка различных вариантов ответа от Telegram API

### Техническая информация
- **Проблема**: Backend возвращал статус `CONFIRMED`, но frontend ожидал только `COMPLETED`
- **Решение**: Добавлена поддержка обоих статусов и fallback для получения профиля
- **Файлы изменены**: `src/types/auth.ts`, `src/services/authApi.ts`, `src/contexts/AuthContext.tsx`
